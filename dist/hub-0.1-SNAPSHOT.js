/*
 hub.js JavaScript library
 https://github.com/mantoni/hub.js

 Copyright 2011, Maximilian Antoni
 Released under the MIT license:
 https://github.com/mantoni/hub.js/raw/master/LICENSE
*/
Hub=function(){function q(a,b){return function(c){var d=j;j=b;m=this;n=c;try{a.call(this,c);j&&b.call(this,c)}finally{j=d;n=m=undefined}}}function o(a,b){for(var c in b){var d=b[c];a[c]=c in a?q(d,a[c]):d}}function k(a){var b={},c=l[a],d=true;if(c){for(var e=c.is?typeof c.is==="string"?[c.is]:c.is:x,g=0,f;f=e[g++];)o(b,h[f]||k(f));o(b,c.factory());if(c.scope===Hub.PROTOTYPE)d=false}if(d)if(a in h)o(h[a],b);else h[a]=b;return b}function r(a){a=a.replace(/\./g,"\\.").replace(/\*\*/g,"[a-zA-Z0-9\\.]+").replace(/\*/g,
"[a-zA-Z0-9]+");return RegExp("^"+a+"$")}function s(a,b,c){if(a[b])a[b](c);else if(b.indexOf("*")!==-1){var d=r(b);for(b in a)if(d.test(b))a[b](c)}}function t(a,b,c){if(c){if(!a.success)return true;try{a.success(b);return true}catch(d){console.warn("Hub - error in promise success handler: "+d.message);return false}}if(a.error)try{a.error(b)}catch(e){console.warn("Hub - error in promise error handler: "+e.message)}return false}function p(a){var b=[],c,d=true;return{then:function(e,g){var f={success:e,
error:g};a?t(f,c,e):b.push(f);return this},publish:function(e,g,f){if(a)return Hub.publish(e,g,f);return this.then(function(){return Hub.publish(e,g,f)})},fulfill:function(e){if(a)throw Error("Hub - promise already fulfilled");a=true;for(c=e;b.length;)d=t(b.shift(),c,d);return this},fulfilled:function(){return a}}}function u(a){var b=p(true);a.then=b.then;a.publish=b.publish;return b}var h={},l={},j=false,m,n,i=true,x=[],v=function(){};v.prototype={then:function(a,b){return u(this).then(a,b)},publish:function(a,
b,c){return u(this).publish(a,b,c)},fulfill:function(){throw Error("Hub - promise already fulfilled");},fulfilled:function(){return true}};return{SINGLETON:"SINGLETON",PROTOTYPE:"PROTOTYPE",reset:function(){h={};l={}},subscribe:function(a,b,c){a=h[a]||k(a);a[b]=b in a?q(c,a[b]):c},node:function(a,b,c){if(l[a])throw Error("Hub - node already defined: "+a);if(typeof b==="function"){c=b;b={}}b.factory=c;l[a]=b;h[a]&&k(a)},publish:function(a,b,c){var d=i;i=false;try{if(a.indexOf("*")===-1)s(h[a]||k(a),
b,c);else{var e,g=[],f=r(a);for(e in l)f.test(e)&&g.push(h[e]||k(e));a=0;for(var w;w=g[a++];)s(w,b,c)}}finally{b=i;i=d;return b||new v}},stopPropagation:function(){j=false},propagate:function(){j.call(m,n);j=false},promise:function(){if(i===true)return p(false);if(i===false)i=p(false);return i},lazy:function(){throw Error("Not yet supported");},alias:function(a,b,c,d){Hub.subscribe(a,b,function(e){return Hub.publish(c,d,e)})}}}();
