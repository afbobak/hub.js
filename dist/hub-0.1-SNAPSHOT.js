/*
 hub.js JavaScript library
 https://github.com/mantoni/hub.js

 Copyright 2011, Maximilian Antoni
 Released under the MIT license:
 https://github.com/mantoni/hub.js/raw/master/LICENSE
*/
Hub=function(){function q(a,b){function c(e){var d=j;j=c.second;o=e;try{c.first(e);j&&c.second(e)}finally{j=d;o=undefined}}c.first=a;c.second=b;return c}function r(a,b){if(a!==b){if(a.first===b)return a.second;if(!(a.second=r(a.second,b)))return a.first;return a}}function p(a,b){for(var c in b){var e=b[c];a[c]=c in a?q(e,a[c]):e}}function l(a){var b={},c=k[a],e=true;if(c){for(var d=c.is?typeof c.is==="string"?[c.is]:c.is:y,g=0,f;f=d[g++];)p(b,h[f]||l(f));p(b,c.factory());if(c.scope===Hub.PROTOTYPE)e=
false}if(e)if(a in h)p(h[a],b);else h[a]=b;return b}function s(a){a=a.replace(/\./g,"\\.").replace(/\*\*/g,"[a-zA-Z0-9\\.]+").replace(/\*/g,"[a-zA-Z0-9]+");return RegExp("^"+a+"$")}function t(a,b,c){Hub.publish("hub.error.error","publish",{message:"Error in callback for {namespace}/{message}: {error}",context:{namespace:a,message:b,error:c}})}function u(a,b,c,e){if(b[c])try{return b[c](e)}catch(d){t(a,c,d.message);return}if(c.indexOf("*")!==-1){var g=s(c),f;for(c in b)if(g.test(c))try{f=Hub.util.merge(f,
b[c](e))}catch(m){t(a,c,m.message)}return f}}function v(a,b,c){if(c){if(!a.success)return true;try{a.success(b);return true}catch(e){console.warn("Hub - error in promise success handler: "+e.message);return false}}if(a.error)try{a.error(b)}catch(d){console.warn("Hub - error in promise error handler: "+d.message)}return false}function n(a){var b=[],c,e=true;return{then:function(d,g){var f={success:d,error:g};a?v(f,c,d):b.push(f);return this},publish:function(d,g,f){if(a){f=Hub.util.merge(c,f);return Hub.publish(d,
g,f)}return this.then(function(){f=Hub.util.merge(c,f);return Hub.publish(d,g,f)})},fulfill:function(d){this.mergeValue(d);for(a=true;b.length;)e=v(b.shift(),c,e);return this},fulfilled:function(){return a},mergeValue:function(d){if(a)throw Error("Hub - promise already fulfilled");c=Hub.util.merge(c,d)}}}function w(a){var b=n(true);a.then=b.then;a.publish=b.publish;return b}var h={},k={},j=false,o,i=true,y=[],x=function(){};x.prototype={then:function(a,b){return w(this).then(a,b)},publish:function(a,
b,c){return w(this).publish(a,b,c)},fulfill:function(){throw Error("Hub - promise already fulfilled");},fulfilled:function(){return true}};return{SINGLETON:"SINGLETON",PROTOTYPE:"PROTOTYPE",reset:function(){h={};for(var a in k)a.indexOf("lib.")===-1&&delete k[a]},subscribe:function(a,b,c){a=h[a]||l(a);a[b]=b in a?q(c,a[b]):c},unsubscribe:function(a,b,c){if(a=h[a])if(a[b]&&!(a[b]=r(a[b],c)))delete a[b]},peer:function(a,b,c){if(k[a])throw Error("Hub - peer already defined: "+a);if(typeof b==="function"){c=
b;b={}}b.factory=c;k[a]=b;h[a]&&l(a)},publish:function(a,b,c){var e=i,d;i=false;if(a.indexOf("*")===-1){var g=h[a]||l(a);d=u(a,g,b,c)}else{var f,m=[];g=s(a);for(f in k)g.test(f)&&m.push(h[f]||l(f));for(f=0;g=m[f++];){g=u(a,g,b,c);d=Hub.util.merge(d,g)}}a=i;i=e;if(d!==undefined)if(a)a.mergeValue(d);else{a=n(false);a.fulfill(d)}return a||new x},stopPropagation:function(){j=false},propagate:function(){j(o);j=false},promise:function(){if(i===true)return n(false);if(i===false)i=n(false);return i},lazy:function(){throw Error("Not yet supported");
},alias:function(a,b,c,e){Hub.subscribe(a,b,function(d){return Hub.publish(c,e,d)})},util:{merge:function(a,b){if(a===undefined||a===null||a===b)return b;if(b===undefined||b===null)return a;var c=Object.prototype.toString.call(b),e=Object.prototype.toString.call(a);if(e===c){if(c==="[object Object]"){for(var d in b)a[d]=arguments.callee(a[d],b[d]);return a}if(c==="[object Array]")return a.concat(b)}Hub.publish("hub.error.warn","util.merge",{message:e===c?"Cannot merge value {target} with {source}":
"Cannot merge type {targetType} with {sourceType}",context:{target:a,source:b,targetType:e,sourceType:c}});return a}}}}();
