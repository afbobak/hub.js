/*
 hub.js JavaScript library
 https://github.com/mantoni/hub.js

 Copyright 2011, Maximilian Antoni
 Released under the MIT license:
 https://github.com/mantoni/hub.js/raw/master/LICENSE
*/
Hub=function(){function p(a,b){function c(d){var e=j;j=c.second;m=d;try{c.first(d);j&&c.second(d)}finally{j=e;m=undefined}}c.first=a;c.second=b;return c}function q(a,b){if(a!==b){if(a.first===b)return a.second;if(!(a.second=q(a.second,b)))return a.first;return a}}function n(a,b){for(var c in b){var d=b[c];a[c]=c in a?p(d,a[c]):d}}function k(a){var b={},c=l[a],d=true;if(c){for(var e=c.is?typeof c.is==="string"?[c.is]:c.is:x,h=0,f;f=e[h++];)n(b,g[f]||k(f));n(b,c.factory());if(c.scope===Hub.PROTOTYPE)d=
false}if(d)if(a in g)n(g[a],b);else g[a]=b;return b}function r(a){a=a.replace(/\./g,"\\.").replace(/\*\*/g,"[a-zA-Z0-9\\.]+").replace(/\*/g,"[a-zA-Z0-9]+");return RegExp("^"+a+"$")}function s(a,b,c){if(a[b])a[b](c);else if(b.indexOf("*")!==-1){var d=r(b);for(b in a)if(d.test(b))a[b](c)}}function t(a,b,c){if(c){if(!a.success)return true;try{a.success(b);return true}catch(d){console.warn("Hub - error in promise success handler: "+d.message);return false}}if(a.error)try{a.error(b)}catch(e){console.warn("Hub - error in promise error handler: "+
e.message)}return false}function o(a){var b=[],c,d=true;return{then:function(e,h){var f={success:e,error:h};a?t(f,c,e):b.push(f);return this},publish:function(e,h,f){if(a)return Hub.publish(e,h,f);return this.then(function(){return Hub.publish(e,h,f)})},fulfill:function(e){if(a)throw Error("Hub - promise already fulfilled");a=true;for(c=e;b.length;)d=t(b.shift(),c,d);return this},fulfilled:function(){return a}}}function u(a){var b=o(true);a.then=b.then;a.publish=b.publish;return b}var g={},l={},j=
false,m,i=true,x=[],v=function(){};v.prototype={then:function(a,b){return u(this).then(a,b)},publish:function(a,b,c){return u(this).publish(a,b,c)},fulfill:function(){throw Error("Hub - promise already fulfilled");},fulfilled:function(){return true}};return{SINGLETON:"SINGLETON",PROTOTYPE:"PROTOTYPE",reset:function(){g={};l={}},subscribe:function(a,b,c){a=g[a]||k(a);a[b]=b in a?p(c,a[b]):c},unsubscribe:function(a,b,c){if(a=g[a])if(a[b]&&!(a[b]=q(a[b],c)))delete a[b]},peer:function(a,b,c){if(l[a])throw Error("Hub - peer already defined: "+
a);if(typeof b==="function"){c=b;b={}}b.factory=c;l[a]=b;g[a]&&k(a)},publish:function(a,b,c){var d=i;i=false;try{if(a.indexOf("*")===-1)s(g[a]||k(a),b,c);else{var e,h=[],f=r(a);for(e in l)f.test(e)&&h.push(g[e]||k(e));a=0;for(var w;w=h[a++];)s(w,b,c)}}finally{b=i;i=d;return b||new v}},stopPropagation:function(){j=false},propagate:function(){j(m);j=false},promise:function(){if(i===true)return o(false);if(i===false)i=o(false);return i},lazy:function(){throw Error("Not yet supported");},alias:function(a,
b,c,d){Hub.subscribe(a,b,function(e){return Hub.publish(c,d,e)})}}}();
